$(document).ready(function(){function e(e){this.name=e,this.fermentablesArray=[],this.hopsArray=[],this.yeastsArray=[],this.adjunctsArray=[]}var t=null,a=JSON.parse(localStorage.getItem("recipeArray")),o=[];a||(a=[{name:"test recipe",fermentablesArray:[],hopsArray:[],yeastsArray:[],adjunctsArray:[]}],localStorage.setItem("recipeArray",JSON.stringify(a)));var s=[],n=JSON.parse(localStorage.getItem("fermentables")),r=JSON.parse(localStorage.getItem("fermentablesFiltered")),l=[],i=JSON.parse(localStorage.getItem("hops")),c=JSON.parse(localStorage.getItem("hopsFiltered")),d=[],p=JSON.parse(localStorage.getItem("yeasts")),y=JSON.parse(localStorage.getItem("yeastsFiltered")),g=[],u=JSON.parse(localStorage.getItem("adjuncts")),f=JSON.parse(localStorage.getItem("adjunctsFiltered")),h=[],b=JSON.parse(localStorage.getItem("styles")),m=JSON.parse(localStorage.getItem("stylesFiltered")),v=function(e,t,a,o,s,n,r){var l=e,i=t,c=r;console.log("loop ",l),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/"+c+"/?key=166f0b6348fdccde864dc9aecb3d50bb&p="+l.toString()).done(function(e){s=s.concat(e.data),l+=1,i>=l?v(l,i,a,o,s,n,r):(a=s,localStorage.setItem(c,JSON.stringify(a)),A(a,o,n,r))}).fail(function(e){console.log("Fail Log: ",e)})},A=function(e,t,a,o){console.log("filterData called");for(var s=[],n=0;n<e.length;n++)e[n].hasOwnProperty(a)&&(s=s.concat(e[n]));t=s,localStorage.setItem(o+"Filtered",JSON.stringify(t)),w(t,o)},w=function(e,t){console.log("Adding",t);for(var a=$(document).find("#"+t+"-selector").children(".api-destination"),o=0;o<e.length;o++){var s=e[o].id,n=e[o].name;if("yeasts"!==t)$(a).append('<option data-id="'+s+'" data-name="'+n+'" data-source="'+t+'">'+n+"</option>");else{var r=e[o].supplier,l=e[o].productId,i=e[o].yeastFormat,c=e[o].yeastType,d=n+" - "+r+" "+l+" - "+i+" "+c+" yeast";$(a).append('<option data-id="'+s+'" data-name="'+d+'" data-source="'+t+'">'+n+" - "+r+" "+l+" - "+i+" "+c+" yeast</option>")}}};n?w(r,"fermentables"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/fermentables/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;s=s.concat(e.data),a>t&&v(t+1,a,n,r,s,"potential","fermentables")}),i?w(c,"hops"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/hops/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;l=l.concat(e.data),a>t&&v(t+1,a,i,c,l,"alphaAcidMin","hops")}),p?w(y,"yeasts"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/yeasts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("number of yeast pages = ",a),d=d.concat(e.data),a>t&&v(t+1,a,p,y,d,"productId","yeasts")}),u?(console.log("adjuncts else"),w(f,"adjuncts")):(console.log("Adjuncts loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/adjuncts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("Number of Adjunct Pages: ",a),g=g.concat(e.data),a>t&&v(t+1,a,u,f,g,"name","adjuncts")})),b?w(m,"styles"):(console.log("loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/styles/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){g=g.concat(e.data),v(1,1,b,m,h,"ibuMin","styles")}));var S=function(e,t,a,o,s){o&&s?$(a).append('<span class="builder-span" data-id="'+e+'">'+t+" - "+o+" "+s+"</span></br>"):$(a).append('<span class="builder-span" data-id="'+e+'">'+t+"</span></br>")};$("a").click(function(e){if(console.log(e.target),$(this).attr("id")){console.log("if statement");var o=a[t],s=$(this).closest("div").find("option:selected").attr("data-id"),n=$(this).closest("div").find("option:selected").attr("data-name");if("brewtype-submit"===$(this).attr("id"))S(s,n,"#builder-type"),o.brewtype=n;else if("styles-submit"===$(this).attr("id"))S(s,n,"#builder-style"),o.styles=n;else if("fermentables-submit"===$(this).attr("id")){var l=$(this).closest("div").find("#fermentables-qty").val(),i=$("#fermentables-units").find("option:selected").attr("data-name"),d=o.fermentablesArray.length;if(console.log(l),console.log(i),l&&i){S(s,n,"#builder-fermentables",l,i);var p=I(r,s);o.fermentablesArray.push(p),o.fermentablesArray[d].quantity=l,o.fermentablesArray[d].units=i,localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else alert("Please enter a quantity.")}else if("hops-submit"===$(this).attr("id")){var g=$(this).closest("div").find("#hops-qty").val(),u=$("#hops-units").find("option:selected").attr("data-name"),d=o.hopsArray.length||0;if(console.log(g),console.log(u),g&&u){S(s,n,"#builder-hops",g,u);var h=I(c,s);o.hopsArray.push(h),o.hopsArray[d].quantity=g,o.hopsArray[d].units=u,localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else alert("Please enter a quantity.")}else if("yeasts-submit"===$(this).attr("id")){var b=$(this).closest("div").find("#yeasts-qty").val(),m=$("#yeasts-units").find("option:selected").attr("data-name"),d=o.yeastsArray.length||0;if(console.log(b),console.log(m),b&&m){S(s,n,"#builder-yeasts",b,m);var v=I(y,s);o.yeastsArray.push(v),o.yeastsArray[d].quantity=b,o.yeastsArray[d].units=m,localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else alert("Please enter a quantity.")}else if("adjuncts-submit"===$(this).attr("id")){var A=$(this).closest("div").find("#adjuncts-qty").val(),w=$("#adjuncts-units").find("option:selected").attr("data-name"),d=o.adjunctsArray.length||0;if(console.log(A),console.log(w),A&&w){S(s,n,"#builder-adjuncts",A,w);var O=I(f,s);o.adjunctsArray.push(O),o.adjunctsArray[d].quantity=A,o.adjunctsArray[d].units=w,localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else alert("Please enter a quantity.")}}});var I=function(e,t){console.log("searching!");for(var a=t,o=0;o<e.length;o++)if(e[o].id==a)return e[o]};$("#description-box").on("keyup keydown keypress",function(e){var t=$("#description-box").val();console.log(t),$("#directions-display").text(t)}),$("#notes-box").on("keyup keydown keypress",function(e){var t=$("#notes-box").val();console.log(t),$("#notes-display").text(t)}),$("#new-recipe-btn").on("click",function(){$("#recipe-search, #new-recipe-btn").fadeOut("slow",function(){$("#name-box").fadeIn("slow",function(){$("#name-box").show()})})}),$("#name-submit").on("click",function(){for(var o=$("#name-input").val(),s=!0,n=0;n<a.length;n++)o===a[n].name&&(s=!1);if($(".start-btn").on("click",function(){$("#recipe-frontpage, #new-recipe-btn, #recipe-search").show(),$("#name-box").hide(),$("#new-recipe").hide()}),s&&o.length){console.log("namebox value: ",o);var r=new e(o);t=a.length,a.push(r),$("#builder-name").append('<h4 id="name-display">'+o+"</h4>"),$("#recipe-frontpage").fadeOut("slow",function(){$("#new-recipe").fadeIn(),$("#recipe-builder").css("opacity","1")}),console.log(a),localStorage.setItem("recipeArray",JSON.stringify(a))}else s?o.length<1?alert("No name detected. Please enter some characters."):console.log("This is failing for some reason and I don't know why."):alert("That name is already taken, please choose another.")}),$("#recipe-submit").on("click",function(){var e=a[t];e.description=$("#description-box").val(),e.notes=$("#notes-box").val(),e.styles&&e.brewtype?(console.log(e.description),console.log(e.notes),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a),$("#recipe-builder").css("opacity","0").find(".refreshable").empty(),$("#new-recipe").hide(function(){$("#recipe-frontpage").fadeIn("slow")}),$("#name-box").fadeOut(),$("#name-input").val(""),$("#recipe-frontpage, #new-recipe-btn, #recipe-search").fadeIn(),$("#recipe-list-container").css("opacity","1"),$("#recipe-list").css("opacity","1"),$("#shopping-list").css("opacity","1"),o.push(e),O(),k()):e.styles?e.brewtype?alert("Something went wrong and I don't know what. You should feel bad."):alert("How do you plan to do this?"):alert("What style is this beer?")});var O=function(){$("#recipe-list").empty();for(var e=0;e<o.length;e++){var t=o[e].name,a=o[e].styles;$("#recipe-list").append("<span>"+t+" - "+a+"</span></br>")}},k=function(){console.log("listing ingredients");for(var e=0;e<o.length;e++)var t=o[e];for(var a=0;a<t.fermentablesArray.length;a++){console.log("writing fermentables");var s=t.fermentablesArray[a].id,n=t.fermentablesArray[a].quantity,r=t.fermentablesArray[a].name,l=t.fermentablesArray[a].units,i=s+r,c=n+r;console.log(n),console.log(s),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-fermentables").append('<span id="'+i+'"data-id="'+s+'">'+r+' - </span><span id="'+i+'q"data-qty="'+n+'">'+n+" "+l+"</span></br>")}for(var d=0;d<t.hopsArray.length;d++){console.log("writing hops");var s=t.hopsArray[d].id,n=t.hopsArray[d].quantity,r=t.hopsArray[d].name,l=t.hopsArray[d].units,i=s+r,c=n+r;console.log(n),console.log(s),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-hops").append('<span id="'+i+'"data-id="'+s+'">'+r+' - </span><span id="'+i+'q"data-qty="'+n+'">'+n+" "+l+"</span></br>")}for(var p=0;p<t.yeastsArray.length;p++){console.log("writing yeasts");var s=t.yeastsArray[p].id,n=t.yeastsArray[p].quantity,r=t.yeastsArray[p].name,l=t.yeastsArray[p].units,i=s+r,c=n+r;console.log(n),console.log(s),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-yeasts").append('<span id="'+i+'"data-id="'+s+'">'+r+' - </span><span id="'+i+'q"data-qty="'+n+'">'+n+" "+l+"</span></br>")}for(var y=0;y<t.adjunctsArray.length;y++){console.log("writing adjuncts");var s=t.ajunctsArray[a].id,n=t.adjunctsArray[a].quantity,r=t.adjunctsArray[a].name,l=t.adjunctsArray[a].units,i=s+r,c=n+r;console.log(n),console.log(s),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-adjuncts").append('<span id="'+i+'"data-id="'+s+'">'+r+' - </span><span id="'+i+'q"data-qty="'+n+'">'+n+" "+l+"</span></br>")}}});