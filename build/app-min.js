$(document).ready(function(){function e(e){this.name=e,this.fermentablesArray=[],this.hopsArray=[],this.yeastsArray=[],this.adjunctsArray=[]}var t=null,a=JSON.parse(localStorage.getItem("recipeArray")),o=[];a||(a=[{name:"test recipe",fermentablesArray:[],hopsArray:[],yeastsArray:[],adjunctsArray:[]}],localStorage.setItem("recipeArray",JSON.stringify(a)));var r=[],n=JSON.parse(localStorage.getItem("fermentables")),s=JSON.parse(localStorage.getItem("fermentablesFiltered")),c=[],i=JSON.parse(localStorage.getItem("hops")),l=JSON.parse(localStorage.getItem("hopsFiltered")),p=[],d=JSON.parse(localStorage.getItem("yeasts")),f=JSON.parse(localStorage.getItem("yeastsFiltered")),u=[],g=JSON.parse(localStorage.getItem("adjuncts")),y=JSON.parse(localStorage.getItem("adjunctsFiltered")),b=[],m=JSON.parse(localStorage.getItem("styles")),h=JSON.parse(localStorage.getItem("stylesFiltered")),v=function(e,t,a,o,r,n,s){var c=e,i=t,l=s;console.log("loop ",c),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/"+l+"/?key=166f0b6348fdccde864dc9aecb3d50bb&p="+c.toString()).done(function(e){r=r.concat(e.data),c+=1,i>=c?v(c,i,a,o,r,n,s):(a=r,localStorage.setItem(l,JSON.stringify(a)),S(a,o,n,s))}).fail(function(e){console.log("Fail Log: ",e)})},S=function(e,t,a,o){console.log("filterData called");for(var r=[],n=0;n<e.length;n++)e[n].hasOwnProperty(a)&&(r=r.concat(e[n]));t=r,localStorage.setItem(o+"Filtered",JSON.stringify(t)),w(t,o)},w=function(e,t){console.log("Adding",t);for(var a=$(document).find("#"+t+"-selector").children(".api-destination"),o=0;o<e.length;o++){var r=e[o].id,n=e[o].name;if("yeasts"!==t)$(a).append('<option data-id="'+r+'" data-name="'+n+'" data-source="'+t+'">'+n+"</option>");else{var s=e[o].supplier,c=e[o].productId,i=e[o].yeastFormat,l=e[o].yeastType,p=n+" - "+s+" "+c+" - "+i+" "+l+" yeast";$(a).append('<option data-id="'+r+'" data-name="'+p+'" data-source="'+t+'">'+n+" - "+s+" "+c+" - "+i+" "+l+" yeast</option>")}}};n?w(s,"fermentables"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/fermentables/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;r=r.concat(e.data),a>t&&v(t+1,a,n,s,r,"potential","fermentables")}),i?w(l,"hops"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/hops/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;c=c.concat(e.data),a>t&&v(t+1,a,i,l,c,"alphaAcidMin","hops")}),d?w(f,"yeasts"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/yeasts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("number of yeast pages = ",a),p=p.concat(e.data),a>t&&v(t+1,a,d,f,p,"productId","yeasts")}),g?(console.log("adjuncts else"),w(y,"adjuncts")):(console.log("Adjuncts loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/adjuncts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("Number of Adjunct Pages: ",a),u=u.concat(e.data),a>t&&v(t+1,a,g,y,u,"name","adjuncts")})),m?w(h,"styles"):(console.log("loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/styles/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){u=u.concat(e.data),v(1,1,m,h,b,"ibuMin","styles")}));var O=function(e,t,a){$(a).append('<span class="builder-span" data-id="'+e+'">'+t+"</span></br>")};$("a").click(function(e){if(console.log(e.target),$(this).attr("id")){console.log("if statement");var o=a[t],r=$(this).closest("div").find("option:selected").attr("data-id"),n=$(this).closest("div").find("option:selected").attr("data-name");if("brewtype-submit"===$(this).attr("id"))O(r,n,"#builder-type"),o.brewtype=n;else if("styles-submit"===$(this).attr("id"))O(r,n,"#builder-style"),o.styles=n;else if("fermentables-submit"===$(this).attr("id")){O(r,n,"#builder-fermentables");var c=I(s,r);o.fermentablesArray.push(c),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("hops-submit"===$(this).attr("id")){O(r,n,"#builder-hops");var i=I(l,r);o.hopsArray.push(i),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("yeasts-submit"===$(this).attr("id")){console.log("local select name = ",n),console.log("local select id: ",r),O(r,n,"#builder-yeasts");var p=I(f,r);o.yeastsArray.push(p),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("adjuncts-submit"===$(this).attr("id")){O(r,n,"#builder-adjuncts");var p=I(y,r);o.adjunctsArray.push(p),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}}});var I=function(e,t){console.log("searching!");for(var a=t,o=0;o<e.length;o++)if(e[o].id==a)return e[o]};$("#description-box").on("keyup keydown keypress",function(e){var t=$("#description-box").val();console.log(t),$("#directions-display").text(t)}),$("#notes-box").on("keyup keydown keypress",function(e){var t=$("#notes-box").val();console.log(t),$("#notes-display").text(t)}),$("#new-recipe-btn").on("click",function(){$("#recipe-search, #new-recipe-btn").fadeOut("slow",function(){$("#name-box").fadeIn("slow",function(){$("#name-box").show()})})}),$("#name-submit").on("click",function(){for(var o=$("#name-input").val(),r=!0,n=0;n<a.length;n++)o===a[n].name&&(r=!1);if($(".start-btn").on("click",function(){$("#recipe-frontpage, #new-recipe-btn, #recipe-search").show(),$("#name-box").hide(),$("#new-recipe").hide()}),r&&o.length){console.log("namebox value: ",o);var s=new e(o);t=a.length,a.push(s),$("#builder-name").append('<h4 id="name-display">'+o+"</h4>"),$("#recipe-frontpage").fadeOut("slow",function(){$("#new-recipe").fadeIn(),$("#recipe-builder").css("opacity","1")}),console.log(a),localStorage.setItem("recipeArray",JSON.stringify(a))}else r?o.length<1?alert("No name detected. Please enter some characters."):console.log("This is failing for some reason and I don't know why."):alert("That name is already taken, please choose another.")}),$("#recipe-submit").on("click",function(){var e=a[t];e.description=$("#description-box").val(),e.notes=$("#notes-box").val(),console.log(e.description),console.log(e.notes),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a),$("#recipe-builder").css("opacity","0").find(".refreshable").empty(),$("#new-recipe").hide(function(){$("#recipe-frontpage").fadeIn("slow")}),$("#name-box").fadeOut(),$("#name-input").val(""),$("#recipe-frontpage, #new-recipe-btn, #recipe-search").fadeIn(),$("#recipe-list").css("opacity","1"),o.push(e),k()});var k=function(){$("#recipe-list").empty();for(var e=0;e<o.length;e++){var t=o[e].name;$("#recipe-list").append("<span>"+t+"</span></br>")}}});