$(document).ready(function(){function e(e){this.name=e,this.fermentablesArray=[],this.hopsArray=[],this.yeastsArray=[],this.adjunctsArray=[]}var t=null,a=JSON.parse(localStorage.getItem("recipeArray"));a||(a=[{name:"test recipe",fermentablesArray:[],hopsArray:[],yeastsArray:[],adjunctsArray:[]}],localStorage.setItem("recipeArray",JSON.stringify(a)));var o=[],r=JSON.parse(localStorage.getItem("fermentables")),s=JSON.parse(localStorage.getItem("fermentablesFiltered")),n=[],c=JSON.parse(localStorage.getItem("hops")),i=JSON.parse(localStorage.getItem("hopsFiltered")),l=[],d=JSON.parse(localStorage.getItem("yeasts")),p=JSON.parse(localStorage.getItem("yeastsFiltered")),u=[],y=JSON.parse(localStorage.getItem("adjuncts")),f=JSON.parse(localStorage.getItem("adjunctsFiltered")),b=[],g=JSON.parse(localStorage.getItem("styles")),m=JSON.parse(localStorage.getItem("stylesFiltered")),h=function(e,t,a,o,r,s,n){var c=e,i=t,l=n;console.log("loop ",c),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/"+l+"/?key=166f0b6348fdccde864dc9aecb3d50bb&p="+c.toString()).done(function(e){r=r.concat(e.data),c+=1,i>=c?h(c,i,a,o,r,s,n):(a=r,localStorage.setItem(l,JSON.stringify(a)),S(a,o,s,n))}).fail(function(e){console.log("Fail Log: ",e)})},S=function(e,t,a,o){console.log("filterData called");for(var r=[],s=0;s<e.length;s++)e[s].hasOwnProperty(a)&&(r="styles"===o?r.concat(e[s].name):r.concat(e[s]));t=r,localStorage.setItem(o+"Filtered",JSON.stringify(t)),v(t,o)},v=function(e,t){for(var a=$(document).find("#"+t+"-selector").children(".api-destination"),o=0;o<e.length;o++){var r=e[o].id,s=e[o].name;if("yeasts"!==t)$(a).append('<option data-id="'+r+'" data-name="'+s+'" data-source="'+t+'">'+s+"</option>");else{var n=e[o].supplier,c=e[o].productId,i=e[o].yeastFormat,l=e[o].yeastType,d=s+" - "+n+" "+c+" - "+i+" "+l+" yeast";$(a).append('<option data-id="'+r+' data-name="'+d+'" data-source="'+t+'">'+s+" - "+n+" "+c+" - "+i+" "+l+" yeast</option>")}}};r?v(s,"fermentables"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/fermentables/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;o=o.concat(e.data),a>t&&h(t+1,a,r,s,o,"potential","fermentables")}),c?v(i,"hops"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/hops/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;n=n.concat(e.data),a>t&&h(t+1,a,c,i,n,"alphaAcidMin","hops")}),d?v(p,"yeasts"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/yeasts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("number of yeast pages = ",a),l=l.concat(e.data),a>t&&h(t+1,a,d,p,l,"productId","yeasts")}),y?v(f,"adjuncts"):(console.log("loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/adjuncts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("Number of Adjunct Pages: ",a),u=u.concat(e.data),a>t&&h(t+1,a,y,f,u,"name","adjuncts")})),g?v(m,"styles"):(console.log("loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/styles/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){u=u.concat(e.data),h(1,1,g,m,b,"ibuMin","styles")}));var O=function(e,t,a,o){$(o).append('<span class="builder-span" data-id="'+e+'">'+t+"</span></br>")};$("a").click(function(e){if(console.log(e.target),$(this).attr("id")){console.log("if statement");var o=a[t],r=$(this).closest("div").find("option:selected").attr("data-id"),n=$(this).closest("div").find("option:selected").attr("data-name");if("brewtype-submit"===$(this).attr("id"))O(r,n,"Type","#builder-type"),o.brewtype=n;else if("styles-submit"===$(this).attr("id"))O(r,n,"Style","#builder-style"),o.styles=n;else if("fermentables-submit"===$(this).attr("id")){O(r,n,"Fermentables","#builder-fermentables");var c=w(s,r);o.fermentablesArray.push(c),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("hops-submit"===$(this).attr("id")){O(r,n,"Hops","#builder-hops");var l=w(i,r);o.hopsArray.push(l),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("yeasts-submit"===$(this).attr("id")){console.log("local select name = ",n),console.log("local select id: ",r),O(r,n,"Yeast","#builder-yeasts");var d=w(p,r);o.yeastsArray.push(d),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}else if("adjuncts-submit"===$(this).attr("id")){O(r,n,"Adjuncts","#builder-adjuncts");var d=w(f,r);o.adjunctsArray.push(d),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a)}}});var w=function(e,t){console.log("searching!");for(var a=t,o=0;o<e.length;o++)if(e[o].id==a)return e[o]};$("#recipe-submit").on("click",function(){var e=a[t];e.description=$("#description-box").value,e.notes=$("#description-box").value}),t&&$("#name-display").text(a[t].name),$("#description-box").on("keyup keydown keypress",function(e){var t=$("#description-box").val();console.log(t),$("#directions-display").text(t)}),$("#notes-box").on("keyup keydown keypress",function(e){var t=$("#notes-box").val();console.log(t),$("#notes-display").text(t)}),$("#name-submit").on("click",function(){var o=$("#name-input").val();console.log("namebox value: ",o);var r=new e(o);t=a.length,a.push(r),$("#recipe-frontpage").fadeOut("slow",function(){$("#new-recipe").fadeIn(),$("#recipe-builder").css("opacity","1")}),console.log(a),localStorage.setItem("recipeArray",JSON.stringify(a))}),$("#new-recipe-btn").on("click",function(){$("#recipe-search, #new-recipe-btn").fadeOut("slow",function(){$("#name-box").fadeIn()})})});