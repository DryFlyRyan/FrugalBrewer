$(document).ready(function(){function e(e){this.name=e,this.ingredients=[]}var t=null,a=JSON.parse(localStorage.getItem("recipeArray"));a||(a=[{name:"test recipe",fermentablesArray:[],hopsArray:[],yeastsArray:[],adjunctsArray:[]}],localStorage.setItem("recipeArray",JSON.stringify(a)));var n=[],o=[],s=JSON.parse(localStorage.getItem("fermentables")),r=JSON.parse(localStorage.getItem("fermentablesFiltered")),l=[],i=JSON.parse(localStorage.getItem("hops")),c=JSON.parse(localStorage.getItem("hopsFiltered")),d=[],p=JSON.parse(localStorage.getItem("yeasts")),g=JSON.parse(localStorage.getItem("yeastsFiltered")),y=[],u=JSON.parse(localStorage.getItem("adjuncts")),f=JSON.parse(localStorage.getItem("adjunctsFiltered")),h=[],b=JSON.parse(localStorage.getItem("styles")),m=JSON.parse(localStorage.getItem("stylesFiltered")),v=[],w=function(e,t,a,n,o,s,r){var l=e,i=t,c=r;console.log("loop ",l),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/"+c+"/?key=166f0b6348fdccde864dc9aecb3d50bb&p="+l.toString()).done(function(e){o=o.concat(e.data),l+=1,i>=l?w(l,i,a,n,o,s,r):(a=o,localStorage.setItem(c,JSON.stringify(a)),A(a,n,s,r))}).fail(function(e){console.log("Fail Log: ",e)})},A=function(e,t,a,n){console.log("filterData called");for(var o=[],s=0;s<e.length;s++)e[s].hasOwnProperty(a)&&(o=o.concat(e[s]));t=o,localStorage.setItem(n+"Filtered",JSON.stringify(t)),S(t,n)},S=function(e,t){console.log("Adding",t);for(var a=$(document).find("#"+t+"-selector").children(".api-destination"),n=0;n<e.length;n++){var o=e[n].id,s=e[n].name;if("yeasts"!==t)$(a).append('<option data-id="'+o+'" data-name="'+s+'" data-source="'+t+'">'+s+"</option>");else{var r=e[n].supplier,l=e[n].productId,i=e[n].yeastFormat,c=e[n].yeastType,d=s+" - "+r+" "+l+" - "+i+" "+c+" yeast";$(a).append('<option data-id="'+o+'" data-name="'+d+'" data-source="'+t+'">'+s+" - "+r+" "+l+" - "+i+" "+c+" yeast</option>")}}};s?S(r,"fermentables"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/fermentables/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;o=o.concat(e.data),a>t&&w(t+1,a,s,r,o,"potential","fermentables")}),i?S(c,"hops"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/hops/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;l=l.concat(e.data),a>t&&w(t+1,a,i,c,l,"alphaAcidMin","hops")}),p?S(g,"yeasts"):$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/yeasts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("number of yeast pages = ",a),d=d.concat(e.data),a>t&&w(t+1,a,p,g,d,"productId","yeasts")}),u?(console.log("adjuncts else"),S(f,"adjuncts")):(console.log("Adjuncts loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/adjuncts/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){var t=e.currentPage,a=e.numberOfPages;console.log("Number of Adjunct Pages: ",a),y=y.concat(e.data),a>t&&w(t+1,a,u,f,y,"name","adjuncts")})),b?S(m,"styles"):(console.log("loop 1"),$.get("https://cors-anywhere.herokuapp.com/http://api.brewerydb.com/v2/styles/?key=166f0b6348fdccde864dc9aecb3d50bb",function(){}).done(function(e){y=y.concat(e.data),w(1,1,b,m,h,"ibuMin","styles")}));var k=1,q=function(e,t){for(var a=0;a<e.length;a++)e[a].id=k,e[a].fbType=t,k+=1,v.push(e[a])};q(r,"fermentable"),q(c,"hops"),q(g,"yeasts"),q(f,"adjuncts"),q(m,"style"),console.log(v);$("#new-recipe-btn").on("click",function(){$("#recipe-search, #new-recipe-btn").fadeOut("slow",function(){$("#name-box").fadeIn("slow",function(){$("#name-box").show()})})});var I=new e;$("#name-submit").on("click",function(){for(var t=$("#name-input").val(),n=!0,o=0;o<a.length;o++)t===a[o].name&&(n=!1);$(".start-btn").on("click",function(){$("#recipe-frontpage, #new-recipe-btn, #recipe-search").show(),$("#name-box").hide(),$("#new-recipe").hide()}),n&&t.length?(console.log("namebox value: ",t),I=new e(t)):n?t.length<1?alert("No name detected. Please enter some characters."):console.log("This is failing for some reason and I don't know why."):alert("That name is already taken, please choose another.")}),$("a").click(function(e){if(console.log(e.target),$(this).attr("id")){console.log("if statement");var t=I,a=null,n=null,o=t.ingredientsArray[t.ingredientsArray.length-1],s=$(this).closest("div").find("option:selected").attr("data-id"),r=($(this).closest("div").find("option:selected").attr("data-name"),$.grep(v,function(e){return e.id==s}));1===r.length?r=r[0]:0===r.length?console.log("result not found in ingredientsMasterList"):console.log("multiple results found"),"brewtype-submit"===$(this).attr("id")?t.brewtype=r:"styles-submit"===$(this).attr("id")?t.styles=r:"fermentables-submit"===$(this).attr("id")?(a=$(this).closest("div").find("#fermentables-qty").val(),n=$("#fermentables-units").find("option:selected").attr("data-name"),a?(t.ingredientsArray.push(r),o.quantity=a,o.units=n):alert("Please enter a quantity.")):"hops-submit"===$(this).attr("id")?(a=$(this).closest("div").find("#hops-qty").val(),n=$("#hops-units").find("option:selected").attr("data-name"),a?(t.ingredientsArray.push(r),o.quantity=a,o.units=n):alert("Please enter a quantity.")):"yeasts-submit"===$(this).attr("id")?(a=$(this).closest("div").find("#yeasts-qty").val(),n=$("#yeasts-units").find("option:selected").attr("data-name"),a?(t.ingredientsArray.push(r),o.quantity=a,o.units=n):alert("Please enter a quantity.")):"adjuncts-submit"===$(this).attr("id")&&(a=$(this).closest("div").find("#adjuncts-qty").val(),n=$("#adjuncts-units").find("option:selected").attr("data-name"),a?(t.ingredientsArray.push(r),o.quantity=a,o.units=n):alert("Please enter a quantity."))}console.log(I)}),$("#description-box").on("keyup keydown keypress",function(e){var t=$("#description-box").val();console.log(t),$("#directions-display").text(t)}),$("#notes-box").on("keyup keydown keypress",function(e){var t=$("#notes-box").val();console.log(t),$("#notes-display").text(t)}),$("#recipe-submit").on("click",function(){var e=a[t];e.description=$("#description-box").val(),e.notes=$("#notes-box").val(),e.styles&&e.brewtype?(console.log(e.description),console.log(e.notes),localStorage.setItem("recipeArray",JSON.stringify(a)),console.log(a),$("#recipe-builder").css("opacity","0").find(".refreshable").empty(),$("#new-recipe").hide(function(){$("#recipe-frontpage").fadeIn("slow")}),$("#name-box").fadeOut(),$("#name-input").val(""),$("#recipe-frontpage, #new-recipe-btn, #recipe-search").fadeIn(),$("#recipe-list-container").css("opacity","1"),$("#recipe-list").css("opacity","1"),$("#shopping-list").css("opacity","1"),n.push(e),O(),j()):e.styles?e.brewtype?alert("Something went wrong and I don't know what. You should feel bad."):alert("How do you plan to do this?"):alert("What style is this beer?")});var O=function(){$("#recipe-list").empty();for(var e=0;e<n.length;e++){var t=n[e].name,a=n[e].styles;$("#recipe-list").append("<span>"+t+" - "+a+"</span></br>")}},j=function(){console.log("listing ingredients");for(var e=0;e<n.length;e++)var t=n[e];for(var a=0;a<t.fermentablesArray.length;a++){console.log("writing fermentables");var o=t.fermentablesArray[a].id,s=t.fermentablesArray[a].quantity,r=t.fermentablesArray[a].name,l=t.fermentablesArray[a].units,i=o+r,c=s+r;console.log(s),console.log(o),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-fermentables").append('<span id="'+i+'"data-id="'+o+'">'+r+' - </span><span id="'+i+'q"data-qty="'+s+'">'+s+" "+l+"</span></br>")}for(var d=0;d<t.hopsArray.length;d++){console.log("writing hops");var o=t.hopsArray[d].id,s=t.hopsArray[d].quantity,r=t.hopsArray[d].name,l=t.hopsArray[d].units,i=o+r,c=s+r;console.log(s),console.log(o),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-hops").append('<span id="'+i+'"data-id="'+o+'">'+r+' - </span><span id="'+i+'q"data-qty="'+s+'">'+s+" "+l+"</span></br>")}for(var p=0;p<t.yeastsArray.length;p++){console.log("writing yeasts");var o=t.yeastsArray[p].id,s=t.yeastsArray[p].quantity,r=t.yeastsArray[p].name,l=t.yeastsArray[p].units,i=o+r,c=s+r;console.log(s),console.log(o),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-yeasts").append('<span id="'+i+'"data-id="'+o+'">'+r+' - </span><span id="'+i+'q"data-qty="'+s+'">'+s+" "+l+"</span></br>")}for(var g=0;g<t.adjunctsArray.length;g++){console.log("writing adjuncts");var o=t.ajunctsArray[a].id,s=t.adjunctsArray[a].quantity,r=t.adjunctsArray[a].name,l=t.adjunctsArray[a].units,i=o+r,c=s+r;console.log(s),console.log(o),console.log(r),console.log(l),console.log(i),console.log(c),$("#sl-adjuncts").append('<span id="'+i+'"data-id="'+o+'">'+r+' - </span><span id="'+i+'q"data-qty="'+s+'">'+s+" "+l+"</span></br>")}}});